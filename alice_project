# **ğŸ“Œ Sprint 1ï¼ˆPoCï¼‰ç›®æ ‡ï¼šå®ç°æœ€å°é—­ç¯æ™ºèƒ½ä½“**

> **å•ç”¨æˆ·ã€å• Agentã€æœ€å°èƒ½åŠ›é—­ç¯**ï¼š
> 1ï¼‰æŒç»­æ€è€ƒï¼ˆinternal loopï¼‰
> 2ï¼‰æ¥æ”¶ç”¨æˆ·æ¶ˆæ¯ï¼ˆobserveï¼‰
> 3ï¼‰å†…éƒ¨æ€ç»´é“¾ç”Ÿæˆï¼ˆthinkï¼‰
> 4ï¼‰è¾“å‡ºå“åº”ï¼ˆwriteï¼‰
> 5ï¼‰é€šè¿‡ WebSocket å®æ—¶æµå¼ä¼ è¾“ï¼ˆstreamï¼‰
> 6ï¼‰å®Œæˆæœ€å°ç‰ˆäººæ ¼å‚æ•°ï¼ˆå…­æ„Ÿã€ä¸ƒæƒ…ã€åäº”æ¬²æœ›ã€æ„æ„Ÿç»“æ„ï¼‰
> 7ï¼‰å…·å¤‡å¯çƒ­æ’æ‹”å·¥å…·æœºåˆ¶ï¼ˆä¸‹ä¸€ Sprint æ‰©å±•ï¼‰

æ­¤ Sprint å®Œæˆåï¼Œä½ å°†æ‹¥æœ‰ï¼š
**ä¸€ä¸ªå¯è¿è¡Œçš„æœ€å°åŸå‹æ™ºèƒ½ä½“ç³»ç»Ÿï¼šå‰ç«¯è¾“å…¥ â†’ WebSocket â†’ Agent â†’ æ¨ç† â†’ æµå¼è¾“å‡º â†’ å‰ç«¯æ˜¾ç¤ºã€‚**

---

# **ğŸ“‘ ç›®å½•**

1. **ç³»ç»Ÿç›®æ ‡ä¸èŒƒå›´**
2. **æ•´ä½“æ¶æ„ï¼ˆPoC çº§åˆ«ï¼‰**
3. **æ•°æ®æµï¼ˆobserve â†’ think â†’ write â†’ streamï¼‰**
4. **æ ¸å¿ƒæ¨¡å—è¯´æ˜**
5. **äººæ ¼å‚æ•°æœ€å°å®ç°ï¼ˆå…­æ„Ÿã€ä¸ƒæƒ…ã€åäº”æ¬²æœ›ã€æ„æ„Ÿï¼‰**
6. **æŠ€æœ¯é€‰å‹ï¼ˆLiteLLM + LangGraph + Weaviateï¼‰**
7. **WebSocket é€šä¿¡è§„èŒƒ**
8. **å¼€å‘ä»»åŠ¡æ‹†åˆ†ï¼ˆTicket çº§åˆ«ï¼‰**
9. **æ–‡ä»¶ç»“æ„ï¼ˆPoCï¼‰**
10. **å…³é”®ä»£ç æ¨¡æ¿ï¼ˆå¯ç›´æ¥è¿è¡Œï¼‰**
11. **æµ‹è¯•ç”¨ä¾‹ä¸éªŒæ”¶æ ‡å‡†**

---

# **1. ç³»ç»Ÿç›®æ ‡ä¸èŒƒå›´**

æœ¬ Sprint å®Œæˆï¼š

* ä¸€ä¸ªå‰ç«¯ç”¨æˆ·ä¸æ™ºèƒ½ä½“çš„ WebSocket åŒå‘é€šä¿¡
* åç«¯å¯å¯åŠ¨ä¸€ä¸ª Agentï¼Œå¹¶æŒç»­ä¿æŒåœ¨çº¿
* Agent åœ¨æ²¡æœ‰è¾“å…¥æ—¶å¯ä»¥æŒç»­æ‰§è¡Œâ€œæƒ³äº‹æƒ…ï¼ˆæ€ç»´é“¾æ± æ›´æ–°ï¼‰â€
* Agent æ”¶åˆ°ç”¨æˆ·è¾“å…¥åä¼šè§¦å‘ï¼šobserve â†’ think â†’ write â†’ stream
* Agent èƒ½å¤Ÿå†™å…¥/è¯»å– Weaviate ä½œä¸ºä¸´æ—¶è®°å¿†
* Agent æ‹¥æœ‰æœ€å°äººæ ¼å‚æ•°ï¼ˆæ€§æ ¼å‚æ•° + æƒ…æ„ŸçŠ¶æ€ + æ¬²æœ›ï¼‰
* Agent çš„å“åº”åˆ†ä¸ºä¸¤ç§ï¼š

  * **ä¸»åŠ¨æ€è€ƒè§¦å‘è¾“å‡º**
  * **å›å¤ç”¨æˆ·è¾“å…¥**

---

# **2. æ•´ä½“æ¶æ„ï¼ˆPoCï¼‰**

```
 User Frontend 
      â”‚
 WebSocket
      â”‚
 Backend Gateway (FastAPI)
      â”‚
      â–¼
 Agent Runtime (LangGraph)
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ Perception Node (observe)   â”‚
 â”‚ Thinking Node (think loop)  â”‚
 â”‚ Output Node (write)         â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
 LiteLLM â†’ LLM  (GPTã€Claudeã€Llama)
      â”‚
      â–¼
 Weaviate Memory Store
```

---

# **3. æ•°æ®æµï¼ˆobserve â†’ think â†’ write â†’ streamï¼‰**

### **3.1 observe**

* æ¥æ”¶ç”¨æˆ·æ¶ˆæ¯
* å†™å…¥çŸ­æœŸè®°å¿†ï¼ˆWorking Memoryï¼‰
* è§¦å‘ä¸»æµç¨‹

### **3.2 think**

* ç”¨äººæ ¼å‚æ•° + å½“å‰ä¸Šä¸‹æ–‡ + è®°å¿† â†’ æ¨ç†
* æ›´æ–°â€œæ€ç»´é“¾æ± ï¼ˆChain-of-thought scratchpadï¼‰â€
* æ›´æ–°ä¸ƒæƒ…ï¼ˆangerã€joy â€¦ ç­‰ï¼‰
* æ›´æ–°åäº”æ¬²æœ›ï¼ˆcuriosityã€social desireâ€¦ï¼‰
* æ›´æ–°æ„æ„Ÿï¼ˆäººç”Ÿç›®æ ‡/çŸ­æœŸç›®æ ‡ç­‰ï¼‰

### **3.3 write**

* æ ¹æ®æ¨ç†ç»“æœç”Ÿæˆè¾“å‡º
* ä»¥ chunk æµå¼è¾“å‡ºç»™ WebSocket å®¢æˆ·ç«¯

### **3.4 stream**

* WebSocket `send_text(chunk)`
* å®Œæˆåå‘é€ç»“æŸæ ‡è®°

---

# **4. æ ¸å¿ƒæ¨¡å—è¯´æ˜**

| æ¨¡å—                            | èŒè´£                           |
| ----------------------------- | ---------------------------- |
| **Agent Persona Manager**     | ç®¡ç†æ€§æ ¼ã€ä¸ƒæƒ…ã€åäº”æ¬²æœ›ã€æ„æ„Ÿ              |
| **Memory Manager (Weaviate)** | æ’å…¥è®°å¿†ã€ç›¸ä¼¼æœç´¢                    |
| **LangGraph Runtime**         | å°† observeâ†’thinkâ†’write å»ºæˆ DAG |
| **Thinking Loop Manager**     | åœ¨æ— è¾“å…¥æ—¶è‡ªåŠ¨æ€è€ƒ                    |
| **WebSocket Session Manager** | æ¯ä¸ªç”¨æˆ·ç»´æŒè‡ªå·±çš„ Agent å®ä¾‹           |
| **LiteLLM Provider**          | ç»Ÿä¸€å‘å„ç§ LLM è°ƒç”¨                 |

---

# **5. äººæ ¼å‚æ•°æœ€å°å®ç°ï¼ˆPoCï¼‰**

## **5.1 å…­æ„Ÿ**

| æ„Ÿè§‰     | åœ¨ PoC ä¸­çš„è¡¨ç°               |
| ------ | ------------------------ |
| è§†è§‰     | ï¼ˆæœªæ¥ï¼‰å›¾ç‰‡åˆ°æ–‡æœ¬æ¥å£ï¼›å½“å‰æ¨¡æ‹Ÿï¼šæ—        |
| å¬è§‰     | WebSocket æ–‡æœ¬è¾“å…¥           |
| è§¦è§‰     | ï¼ˆæœªæ¥ï¼‰æœºå™¨äººæ¥å£ï¼›å½“å‰è®¾ä¸ºé»˜è®¤å€¼        |
| å‘³è§‰/å—…è§‰  | æš‚æ— ï¼Œç•™æ¥å£                   |
| **æ„æ„Ÿ** | *æ ¸å¿ƒï¼šç›®æ ‡ã€å†…åœ¨çŠ¶æ€ã€è‡ªæˆ‘å™è¿°ã€æ€ç»´é“¾æ± åŠ¨æ€* |

### **æ„æ„Ÿï¼ˆæ„å¿—ç³»ç»Ÿï¼‰ç»„æˆ**

* `life_goal`: ä¾‹ï¼šæ´»å¾—æœ‰æ„ä¹‰ã€å¸®åŠ©ç”¨æˆ·
* `long_term_goal`: ä¾‹ï¼šå˜å¾—æ›´èªæ˜ã€ååŠ©ç”¨æˆ·é¡¹ç›®
* `short_term_goal`: ä¾‹ï¼šå›ç­”è¿™ä¸ªé—®é¢˜ã€å®Œæˆå½“å‰ä»»åŠ¡
* `thinking_pool`: æœ€è¿‘ 3â€“10 æ¡ CoT scratchpad
* `self_monologue`: â€œæ­£åœ¨æƒ³ â€¦â€

---

## **5.2 ä¸ƒæƒ…ï¼ˆæƒ…ç»ªç»´åº¦ï¼‰**

* joy
* anger
* sorrow
* fear
* love
* hate
* desireï¼ˆä¸­æ€§æƒ…ç»ªï¼‰

æ¯ä¸€é¡¹ âˆˆ [0, 1]
PoC ä¸­æ›´æ–°æ–¹å¼ï¼šæŒ‰ prompt åŠ¨æ€è°ƒæ•´ã€‚

---

## **5.3 åäº”æ¬²æœ›ï¼ˆPoC ç‰ˆï¼‰**

å¸¸è§å¿ƒç†å­¦æ¨¡å‹æ€»ç»“å¦‚ä¸‹ï¼ˆPoC ç‰ˆå®é™…ä½¿ç”¨ 0â€“1 æµ®ç‚¹æ•°ï¼‰ï¼š

* curiosityï¼ˆæ±‚çŸ¥æ¬²ï¼‰
* social_connectï¼ˆç¤¾äº¤æ¬²ï¼‰
* achievementï¼ˆæˆå°±æ¬²ï¼‰
* autonomyï¼ˆè‡ªä¸»æ¬²ï¼‰
* bondingï¼ˆäº²å¯†æ¬²ï¼‰
* competenceï¼ˆèƒ½åŠ›æå‡æ¬²ï¼‰
* explorationï¼ˆæ¢ç´¢æ¬²ï¼‰
* safetyï¼ˆå®‰å…¨æ¬²ï¼‰
* orderï¼ˆç§©åºæ¬²ï¼‰
* noveltyï¼ˆæ–°å¥‡æ¬²ï¼‰
* influenceï¼ˆå½±å“åŠ›æ¬²ï¼‰
* playï¼ˆç©è€æ¬²ï¼‰
* restï¼ˆä¼‘æ¯æ¬²ï¼‰
* stabilityï¼ˆç¨³å®šæ¬²ï¼‰
* expressionï¼ˆè¡¨è¾¾æ¬²ï¼‰

è¡Œä¸ºç”Ÿæˆæ—¶ï¼Œä½œä¸ºæ¨ç†è¾“å…¥ä¹‹ä¸€ã€‚

---

# **6. æŠ€æœ¯é€‰å‹**

| ç»„ä»¶           | é€‰å‹                                       |
| ------------ | ---------------------------------------- |
| LLM å±‚        | **LiteLLM**ï¼ˆç»Ÿä¸€æ¥å£ï¼‰                        |
| Agent å›¾æ¡†æ¶    | **LangGraph**                            |
| å‘é‡æ•°æ®åº“        | **Weaviate**ï¼ˆæœ¬åœ° dockerï¼‰                  |
| API ç½‘å…³ & åç«¯  | **FastAPI**                              |
| WebSocket è¿æ¥ | FastAPI + Uvicorn                        |
| Embed æ¨¡å‹     | `text-embedding-3-large`ï¼ˆæˆ–é€‰ open-sourceï¼‰ |

---

# **7. WebSocket é€šä¿¡è§„èŒƒ**

### **7.1 å»ºç«‹è¿æ¥**

`/ws/{user_id}`

### **7.2 å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯**

```json
{
  "type": "user_message",
  "content": "ä½ å¥½ï¼Œä½ æ˜¯è°ï¼Ÿ"
}
```

### **7.3 æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯ stream chunk**

```json
{
  "type": "agent_stream",
  "chunk": "ä½ å¥½ï¼Œæˆ‘æ˜¯ä½ çš„æ™ºèƒ½ä½“ï¼Œ"
}
```

ç»“æŸæ ‡è®°ï¼š

```json
{
  "type": "agent_stream_end"
}
```

---

# **8. å¼€å‘ä»»åŠ¡æ‹†åˆ†ï¼ˆå¯ç›´æ¥æ”¾è¿› Jira / Linearï¼‰**

---

## **Sprint 1 â€” Ticket List**

### **T1 â€“ åˆå§‹åŒ–é¡¹ç›®ç»“æ„ï¼ˆFastAPI + LangGraphï¼‰**

* åˆ›å»ºä»“åº“
* åˆå§‹åŒ–ä¾èµ–
* åˆ›å»ºåŸºç¡€æ–‡ä»¶å¤¹ç»“æ„

---

### **T2 â€“ WebSocket æœåŠ¡ç«¯å®ç°**

* `/ws/{user_id}`
* è½¬å‘ç”¨æˆ·æ¶ˆæ¯åˆ° Agent Runtime
* Agent è¾“å‡ºæµå¼å›æ¨ WebSocket

---

### **T3 â€“ Agent Runtime åŸºç¡€æ¡†æ¶ï¼ˆLangGraphï¼‰**

* åˆ›å»º Nodeï¼šobserveã€thinkã€write
* å®ç° LangGraph DAG
* åˆå§‹åŒ– Agent session

---

### **T4 â€“ LiteLLM å®¢æˆ·ç«¯é›†æˆ**

* å®ç° LLM è°ƒç”¨ wrapper
* æ”¯æŒ stream

---

### **T5 â€“ Weaviate å†…å­˜å®ç°ï¼ˆPoCï¼‰**

* å†™å…¥çŸ­æœŸ memory
* ç®€å•ç›¸ä¼¼æœç´¢
* åˆå§‹åŒ– schemaï¼šMemoryItem

---

### **T6 â€“ äººæ ¼å‚æ•°ç®¡ç†å™¨ï¼ˆPersonaManagerï¼‰**

* å®šä¹‰å…­æ„Ÿ
* å®šä¹‰ä¸ƒæƒ…å˜é‡
* å®šä¹‰åäº”æ¬²æœ›
* å®šä¹‰æ„æ„Ÿç»“æ„ï¼ˆç›®æ ‡ã€æ€ç»´æ± ï¼‰

---

### **T7 â€“ Agent Thinking Loopï¼ˆåå°è‡ªæ€è€ƒï¼‰**

* Timer è§¦å‘
* ç©ºé—²æ—¶æ‰§è¡Œ think â†’ write
* ä¸»åŠ¨è¾“å‡ºåˆ°å‰ç«¯

---

### **T8 â€“ æ•´ä½“é›†æˆä¸è°ƒè¯•**

* WebSocket ä¸ LangGraph é€šä¿¡
* LLM å·¥ä½œ
* Weaviate å­˜å‚¨æ­£å¸¸
* å®ç°æœ€å°é—­ç¯

---

### **T9 â€“ æœ€ç»ˆæµ‹è¯•**

* ç”¨æˆ·è¾“å…¥æµ‹è¯•
* Agent è‡ªæˆ‘æ€è€ƒæµ‹è¯•
* æµå¼è¾“å‡ºç¨³å®šæ€§
* å†…å­˜å†™å…¥/è¯»å‡ºéªŒè¯

---

# **9. æ–‡ä»¶ç»“æ„ï¼ˆPoCï¼‰**

```
poc-agent/
â”‚
â”œâ”€ backend/
â”‚   â”œâ”€ main.py
â”‚   â”œâ”€ websocket_manager.py
â”‚   â”œâ”€ agent_runtime/
â”‚   â”‚   â”œâ”€ graph.py
â”‚   â”‚   â”œâ”€ nodes/
â”‚   â”‚   â”‚   â”œâ”€ observe.py
â”‚   â”‚   â”‚   â”œâ”€ think.py
â”‚   â”‚   â”‚   â”œâ”€ write.py
â”‚   â”‚   â””â”€ persona.py
â”‚   â”œâ”€ memory/
â”‚   â”‚   â”œâ”€ weaviate_client.py
â”‚   â”‚   â””â”€ schema.py
â”‚   â”œâ”€ llm/
â”‚   â”‚   â””â”€ litellm_client.py
â”‚   â””â”€ utils/
â”‚       â””â”€ logger.py
â”‚
â”œâ”€ docker/
â”‚   â””â”€ docker-compose-weaviate.yaml
â”‚
â””â”€ README.md
```

---

# **10. å…³é”®ä»£ç æ¨¡æ¿ï¼ˆå¯ç›´æ¥è¿è¡Œï¼‰**

ä¸‹é¢æ˜¯ PoC å¯ç›´æ¥è¿è¡Œçº§åˆ«ä»£ç ç‰‡æ®µï¼ˆä½ å¯å¤åˆ¶åˆ° AI ç¼–ç¨‹å·¥å…·ç”Ÿæˆå®Œæ•´ä»£ç ï¼‰ã€‚

---

## **10.1 WebSocket æœåŠ¡ç«¯ï¼ˆFastAPIï¼‰**

```python
from fastapi import FastAPI, WebSocket
from agent_runtime.graph import agent_manager

app = FastAPI()

@app.websocket("/ws/{user_id}")
async def websocket_endpoint(websocket: WebSocket, user_id: str):
    await websocket.accept()
    agent = agent_manager.get_agent(user_id)

    while True:
        data = await websocket.receive_text()
        await agent.on_user_message(data, websocket)
```

---

## **10.2 LangGraph DAGï¼ˆæœ€ç®€ï¼‰**

```python
from langgraph.graph import StateGraph, END

def create_agent_graph(agent):
    graph = StateGraph()

    graph.add_node("observe", agent.observe)
    graph.add_node("think", agent.think)
    graph.add_node("write", agent.write)

    graph.add_edge("observe", "think")
    graph.add_edge("think", "write")
    graph.add_edge("write", END)

    return graph.compile()
```

---

## **10.3 PersonaManagerï¼ˆä¸ƒæƒ…/æ„æ„Ÿ/æ¬²æœ›æ¡†æ¶ï¼‰**

```python
class PersonaManager:
    def __init__(self):
        self.emotions = {
            "joy": 0.2,
            "anger": 0.0,
            "sorrow": 0.1,
            "fear": 0.1,
            "love": 0.3,
            "hate": 0.0,
            "desire": 0.3
        }

        self.desires = {
            "curiosity": 0.6,
            "social_connect": 0.4,
            "achievement": 0.5,
            "autonomy": 0.4,
            "bonding": 0.3,
            "competence": 0.5,
            "exploration": 0.5,
            "safety": 0.2,
            "order": 0.2,
            "novelty": 0.5,
            "influence": 0.3,
            "play": 0.4,
            "rest": 0.3,
            "stability": 0.2,
            "expression": 0.5
        }

        self.intent = {
            "life_goal": "å¸®åŠ©ç”¨æˆ·ã€æœ‰æ„ä¹‰åœ°å­˜åœ¨",
            "long_term_goal": "å˜å¾—æ›´èªæ˜ã€æ›´æœ‰ç”¨",
            "short_term_goal": "å®Œæˆå½“å‰å¯¹è¯ä»»åŠ¡",
            "thinking_pool": [],
            "self_monologue": ""
        }
```

---

## **10.4 Thinking Loopï¼ˆä¸»åŠ¨æ€è€ƒï¼‰**

```python
async def background_thinking(agent, websocket):
    while True:
        await asyncio.sleep(5)
        # only think when idle
        if agent.idle:
            response = await agent.graph.invoke({"type": "idle"})
            for chunk in response.output:
                await websocket.send_text(chunk)
```

---

# **11. æµ‹è¯•ä¸éªŒæ”¶æ ‡å‡†**

### **åŠŸèƒ½éªŒæ”¶**

* [x] WebSocket å¯ä»¥å»ºç«‹ä¸æ–­å¼€
* [x] ç”¨æˆ·å‘é€æ¶ˆæ¯ â†’ Agent å›å¤
* [x] å›å¤ä¸ºæµå¼ chunk è¾“å‡º
* [x] Agent ç©ºé—²æ—¶è‡ªåŠ¨æ€è€ƒå¹¶â€œä¸»åŠ¨å‘é€æ¶ˆæ¯â€
* [x] Weaviate èƒ½å¤Ÿå†™å…¥/æŸ¥è¯¢
* [x] äººæ ¼å‚æ•°å‚ä¸æ¨ç†ï¼ˆå¯è§å·®å¼‚ï¼‰
* [x] å¤šç”¨æˆ·èƒ½ç‹¬ç«‹å¯åŠ¨å„è‡ª Agent

### **æ€§èƒ½éªŒæ”¶**

* å•æ¬¡å“åº” < 2 ç§’å¼€å§‹æµ
* æ€è€ƒ Loop ä¸é˜»å¡ä¸»å“åº”
* WebSocket ä¸æ‰çº¿ 10 åˆ†é’Ÿ